{"version":3,"file":"static/webpack/static\\development\\pages\\dashboard\\admin\\users\\active.js.88b4f632128952aebc97.hot-update.js","sources":["webpack:///./components/DashboardUser/ActiveUsers.js"],"sourcesContent":["import AdminLayoutHoc from '../Layout/AdminLayoutHoc';\r\nimport Link from 'next/link';\r\nimport Table from '../Table';\r\nimport Modal from '../Modal';\r\nimport Alert from '../Alert';\r\nimport SearchInput from '../SearchInput';\r\nimport { withRouter } from 'next/router';\r\n\r\nclass Index extends React.Component {\r\n  constructor (props) {\r\n    super(props)\r\n    this.state = {\r\n      data: [],\r\n      block: {\r\n        id: 0,\r\n        name: '',\r\n        reason_block: '',\r\n      },\r\n      search: '',\r\n      total: 0,\r\n      table: {\r\n        pages: 0,\r\n        loading: false,\r\n        header: [\r\n          {title: \"#\", size: \"75px\"},\r\n          {title: \"Profile\", size: \"150px\"},\r\n          {title: \"Name\", size: \"auto\"},\r\n          {title: \"Action\", size: \"200px\"}\r\n        ]\r\n      },\r\n      alert: {\r\n        block_danger: '',\r\n        block_success: '',\r\n      }\r\n    }\r\n\r\n    this.onBlock = this.onBlock.bind(this)\r\n    this.onChange = this.onChange.bind(this)\r\n    this.queryName = this.queryName.bind(this)\r\n    this.onRefresh = this.onRefresh.bind(this)\r\n    this.submitBlock = this.submitBlock.bind(this)\r\n  }\r\n\r\n  onBlock (user) {\r\n    const {block} = this.state\r\n    block.id = user.id\r\n    block.name = user.name\r\n    console.log(block)\r\n    this.setState({block})\r\n  }\r\n\r\n  onChange (event) {\r\n    const {block} = this.state\r\n    block[event.target.name] = event.target.value\r\n\r\n    this.setState({block})\r\n  }\r\n\r\n  async queryName () {\r\n    await Router.push({\r\n      pathname: '/dashboard/admin/users/active',\r\n      query: {\r\n        page: 1,\r\n        name: this.state.search\r\n      }\r\n    })\r\n    this.onRefresh()\r\n  }\r\n\r\n  async onRefresh () {\r\n    const table = this.state.table\r\n    table.loading = true\r\n    this.setState({ table })\r\n\r\n    let {page, name} = this.props.router.query\r\n    if (typeof page === \"undefined\") page = 1\r\n    if (typeof name === \"undefined\") name = \"\"\r\n\r\n    const response = await fetch(`http://127.0.0.1:8000/fact/user?page=${page}&name=${name}`)\r\n    const json = await response.json()\r\n\r\n    const data = json.results.users\r\n    const total = json.results.total\r\n    table.pages = json.results.pages\r\n    table.loading = false\r\n\r\n    this.setState({ data, table, total })\r\n  }\r\n\r\n  async submitBlock () {\r\n    const alert = this.state.alert\r\n    const body = JSON.stringify(this.state.block)\r\n    const response = await fetch(`http://127.0.0.1:8000/fact/user/` + this.state.block.id, {method: 'DELETE', body})\r\n    const json = await response.json()\r\n\r\n    if (typeof json.message === 'undefined' || json.message !== 'Success') {\r\n      alert.block_danger = \"500 — Internal Server Error\"\r\n      await this.setState({alert})\r\n    }\r\n    else {\r\n      alert.block_success = \"Block User, \" + body.name + \" — Success\"\r\n      const block = {\r\n        id: 0,\r\n        name: '',\r\n        reason_block: '',\r\n      }\r\n\r\n      await this.setState({alert, block})\r\n      await this.onRefresh()\r\n    }\r\n  }\r\n\r\n  componentDidMount () {\r\n    this.onRefresh()\r\n  }\r\n\r\n  render() {\r\n    const tbody = []\r\n    for (let i = 0, l = this.state.data.length; i < l; i++) {\r\n      const user = this.state.data[i];\r\n      tbody.push(\r\n        <tr key={user.id}>\r\n          <td>{i + 1}</td>\r\n          <td>\r\n            <i className=\"fa fa-user-circle\" style={{fontSize: \"50px\"}}/>\r\n          </td>\r\n          <td>{user.name}</td>\r\n          <td>\r\n            <Link href={`/dashboard/admin/users/active?status=view&id=${user.id}`}>\r\n              <a className=\"btn btn-link\">View</a>\r\n            </Link>\r\n            <button className=\"btn btn-link text-danger ml-3\" data-toggle=\"modal\" data-target=\"#block\" onClick={() =>  this.onBlock(user)}>Delete</button>\r\n          </td>\r\n        </tr>\r\n      )\r\n    }\r\n\r\n    return (\r\n      <AdminLayoutHoc contentTitle={`Active Users (${this.state.total})`} contentBreadcrumb={[\"Home\", \"Users\", \"Active Users\"]}>\r\n        <Alert type=\"danger\" component={this} attribute=\"block_danger\"/>\r\n        <Alert type=\"success\" component={this} attribute=\"block_success\"/>\r\n        <div className=\"card\">\r\n          <div className=\"card-body\">\r\n            <div className=\"form-inline\">\r\n              <SearchInput placeholder=\"Search by name\" onClick={this.queryName} value={this.state.search} onChange={(event) => this.setState({search: event.target.value})}/>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <Table table={this.state.table}>\r\n          {tbody}\r\n        </Table>\r\n\r\n        <Modal id=\"block\" title=\"Block User\">\r\n          <div className=\"modal-body\">\r\n            <p>Are you sure you want to block {this.state.block.name}?</p>\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <div className=\"col-md-6\">\r\n              <button type=\"button\" className=\"btn btn-light btn-block\" data-dismiss=\"modal\">No</button>\r\n            </div>\r\n            <div className=\"col-md-6\">\r\n              <button type=\"button\" className=\"btn btn-danger btn-block\" data-dismiss=\"modal\" data-toggle=\"modal\" data-target=\"#confirmation\">Yes</button>\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n\r\n        <Modal id=\"confirmation\" title=\"Reason for blocking\">\r\n          <div className=\"modal-body\">\r\n            <textarea name=\"reason_block\" value={this.state.block.reason_block} onChange={this.onChange} className=\"form-control\" rows=\"3\" />\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <div className=\"col-md-6\">\r\n              <button type=\"button\" className=\"btn btn-danger btn-block\" data-dismiss=\"modal\" onClick={this.submitBlock}>Save</button>\r\n            </div>\r\n            <div className=\"col-md-6\">\r\n              <button type=\"button\" className=\"btn btn-light btn-block\" data-dismiss=\"modal\">No</button>\r\n            </div>\r\n          </div>\r\n        </Modal>\r\n      </AdminLayoutHoc>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withRouter(Index)\r\n"],"mappings":"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","sourceRoot":""}